{-# OPTIONS --cubical #-}

module ccc where

open import contextual

open import Cubical.Categories.Category

private
  variable
    â„“â‚ â„“â‚‚ : Level

-- Here is a definition of a Cartesian Closed Contextual Category

record CCC (ğ’ : Contextual â„“â‚ â„“â‚‚) : Type (â„“â‚ âŠ” â„“â‚‚) where
  open Contextual ğ’
  
  -- the product is given by âŠ¹ with pairing given by âŠ•

  field
    _â‡›_ : ty â†’ ty â†’ ty
    Î› : {Î“ : ctx} {A B : ty} â†’ tm (Î“ âŠ¹ A) B â†’ tm Î“ (A â‡› B)
    ğ‘ğ‘ğ‘ : {Î“ : ctx} {A B : ty} â†’ tm Î“ (A â‡› B) â†’ tm Î“ A â†’ tm Î“ B

  -- Categorical app operator
  ğ´ğ‘ğ‘ : {Î“ : ctx} {A B : ty} â†’ tm Î“ (A â‡› B) â†’ tm (Î“ âŠ¹ A) B
  ğ´ğ‘ğ‘ t = ğ‘ğ‘ğ‘ (t âŸ¦ Ï€ âŸ§) ğ‘§

  field
    Î›nat : {Î“ Î” : ctx} {A B : ty} (t : tm (Î” âŠ¹ A) B) (Ïƒ : tms Î“ Î”) â†’
      Î› t âŸ¦ Ïƒ âŸ§ â‰¡  Î› ( t âŸ¦ Wâ‚‚tms A Ïƒ âŸ§)
    ğ‘ğ‘ğ‘Î² : {Î“ : ctx} {A B : ty} (t : tm (Î“ âŠ¹ A) B) (s : tm Î“ A) â†’
      ğ‘ğ‘ğ‘ (Î› t) s â‰¡ t âŸ¦ ğ’¾ğ’¹ Î“ âŠ• s âŸ§
    ğ‘ğ‘ğ‘Î· : {Î“ : ctx} {A B : ty} (t : tm Î“ (A â‡› B)) â†’
      t â‰¡ Î› (ğ´ğ‘ğ‘ t)

  -- Some useful lemmas

  âŠ•âŠš : {Î“ Î” Î£ : ctx} {A : ty} (Ïƒ : tms Î” Î£) (t : tm Î” A) (Ï„ : tms Î“ Î”) â†’
    (Ïƒ âŠ• t) âŠš Ï„ â‰¡ (Ïƒ âŠš Ï„) âŠ• (t âŸ¦ Ï„ âŸ§)
  âŠ•âŠš Ïƒ t Ï„ =
    (Ïƒ âŠ• t) âŠš Ï„
      â‰¡âŸ¨ Ï€ğ‘§Î· (Ïƒ âŠ• t âŠš Ï„) â»Â¹ âŸ©
    Ï€ âŠš (Ïƒ âŠ• t âŠš Ï„) âŠ• ğ‘§ âŸ¦ Ïƒ âŠ• t âŠš Ï„ âŸ§
      â‰¡âŸ¨ (Î» i â†’ âŠšAssoc Ï€ (Ïƒ âŠ• t) Ï„ (~ i) âŠ• âŸ¦âŸ§âŸ¦âŸ§ ğ‘§ (Ïƒ âŠ• t) Ï„ (~ i)) âŸ©
    Ï€ âŠš (Ïƒ âŠ• t) âŠš Ï„ âŠ• ğ‘§ âŸ¦ Ïƒ âŠ• t âŸ§ âŸ¦ Ï„ âŸ§
      â‰¡âŸ¨ (Î» i â†’ (Ï€Î² (Ïƒ âŠ• t) i âŠš Ï„) âŠ• (ğ‘§Î² (Ïƒ âŠ• t) i âŸ¦ Ï„ âŸ§)) âŸ©
    (Ïƒ âŠš Ï„) âŠ• (t âŸ¦ Ï„ âŸ§)
      âˆ

  private
    lem : {Î“ Î” : ctx} {A : ty} (Ïƒ : tms Î“ Î”) (t : tm Î“ A) â†’
      ((Ïƒ âŠš Ï€) âŠ• ğ‘§) âŠš (ğ’¾ğ’¹ Î“ âŠ• t) â‰¡ Ïƒ âŠ• t
    lem {Î“} Ïƒ t =
      ((Ïƒ âŠš Ï€) âŠ• ğ‘§) âŠš (ğ’¾ğ’¹ Î“ âŠ• t)
        â‰¡âŸ¨ âŠ•âŠš (Ïƒ âŠš Ï€) ğ‘§ (ğ’¾ğ’¹ Î“ âŠ• t) âŸ©
      Ïƒ âŠš Ï€ âŠš (ğ’¾ğ’¹ Î“ âŠ• t) âŠ• ğ‘§ âŸ¦ ğ’¾ğ’¹ Î“ âŠ• t âŸ§
        â‰¡âŸ¨ (Î» i â†’ âŠšAssoc Ïƒ Ï€ (ğ’¾ğ’¹ Î“ âŠ• t) i âŠ• ğ‘§Î² (ğ’¾ğ’¹ Î“ âŠ• t) i) âŸ©
      Ïƒ âŠš (Ï€ âŠš (ğ’¾ğ’¹ Î“ âŠ• t)) âŠ• t
        â‰¡âŸ¨ (Î» i â†’ Ïƒ âŠš (Ï€Î² (ğ’¾ğ’¹ Î“ âŠ• t) i) âŠ• t) âŸ©
      Ïƒ âŠš ğ’¾ğ’¹ Î“ âŠ• t
        â‰¡âŸ¨ ap (_âŠ• t) (ğ’¾ğ’¹R Ïƒ) âŸ©
      Ïƒ âŠ• t
        âˆ

  ğ´ğ‘ğ‘Î² : {Î“ : ctx} {A B : ty} (t : tm (Î“ âŠ¹ A) B) â†’
    ğ´ğ‘ğ‘ (Î› t) â‰¡ t
  ğ´ğ‘ğ‘Î² {Î“} {A} {B} t =
    ğ‘ğ‘ğ‘ (Î› t âŸ¦ Ï€ âŸ§) ğ‘§
      â‰¡âŸ¨ (Î» i â†’ ğ‘ğ‘ğ‘ (Î›nat t Ï€ i) ğ‘§) âŸ©
    ğ‘ğ‘ğ‘ (Î› (t âŸ¦ (Ï€ âŠš Ï€) âŠ• ğ‘§ âŸ§)) ğ‘§
      â‰¡âŸ¨ ğ‘ğ‘ğ‘Î² (t âŸ¦ (Ï€ âŠš Ï€) âŠ• ğ‘§ âŸ§) ğ‘§ âŸ©
    t âŸ¦ (Ï€ âŠš Ï€) âŠ• ğ‘§ âŸ§ âŸ¦ ğ’¾ğ’¹ (Î“ âŠ¹ A) âŠ• ğ‘§ âŸ§
      â‰¡âŸ¨ âŸ¦âŸ§âŸ¦âŸ§ t ((Ï€ âŠš Ï€) âŠ• ğ‘§) (ğ’¾ğ’¹ (Î“ âŠ¹ A) âŠ• ğ‘§) âŸ©
    t âŸ¦ ((Ï€ âŠš Ï€) âŠ• ğ‘§) âŠš (ğ’¾ğ’¹ (Î“ âŠ¹ A) âŠ• ğ‘§) âŸ§
      â‰¡âŸ¨ ap (t âŸ¦_âŸ§) (lem Ï€ ğ‘§) âŸ©
    t âŸ¦ Ï€ âŠ• ğ‘§ âŸ§
      â‰¡âŸ¨ ap (t âŸ¦_âŸ§) ğ’¾ğ’¹Î· âŸ©
    t âŸ¦ ğ’¾ğ’¹ (Î“ âŠ¹ A) âŸ§
      â‰¡âŸ¨ ğ’¾ğ’¹âŸ¦âŸ§ t âŸ©
    t
      âˆ

  ğ´ğ‘ğ‘âŸ¦âŸ§ : {Î“ Î” : ctx} {A B : ty} (t : tm Î” (A â‡› B)) (Ïƒ : tms Î“ Î”) â†’
    ğ´ğ‘ğ‘ (t âŸ¦ Ïƒ âŸ§) â‰¡ (ğ´ğ‘ğ‘ t âŸ¦ Ïƒ âŠš Ï€ âŠ• ğ‘§ âŸ§)
  ğ´ğ‘ğ‘âŸ¦âŸ§ t Ïƒ =
    ğ´ğ‘ğ‘ (t âŸ¦ Ïƒ âŸ§)
      â‰¡âŸ¨ (Î» i â†’ ğ´ğ‘ğ‘ (ğ‘ğ‘ğ‘Î· t i âŸ¦ Ïƒ âŸ§)) âŸ©
    ğ´ğ‘ğ‘ (Î› (ğ´ğ‘ğ‘ t) âŸ¦ Ïƒ âŸ§)
      â‰¡âŸ¨ ap ğ´ğ‘ğ‘ (Î›nat (ğ´ğ‘ğ‘ t) Ïƒ) âŸ©
    ğ´ğ‘ğ‘ (Î› (ğ´ğ‘ğ‘ t âŸ¦ Ïƒ âŠš Ï€ âŠ• ğ‘§ âŸ§))
      â‰¡âŸ¨ ğ´ğ‘ğ‘Î² (ğ´ğ‘ğ‘ t âŸ¦ Ïƒ âŠš Ï€ âŠ• ğ‘§ âŸ§) âŸ©
    ğ´ğ‘ğ‘ t âŸ¦ Ïƒ âŠš Ï€ âŠ• ğ‘§ âŸ§
      âˆ

  ğ‘ğ‘ğ‘ğ´ğ‘ğ‘ : {Î“ : ctx} {A B : ty} (t : tm Î“ (A â‡› B)) (s : tm Î“ A) â†’
    ğ‘ğ‘ğ‘ t s â‰¡ ğ´ğ‘ğ‘ t âŸ¦ ğ’¾ğ’¹ Î“ âŠ• s âŸ§
  ğ‘ğ‘ğ‘ğ´ğ‘ğ‘ {Î“} t s =
    ğ‘ğ‘ğ‘ t s
      â‰¡âŸ¨ (Î» i â†’ ğ‘ğ‘ğ‘ (ğ‘ğ‘ğ‘Î· t i) s) âŸ©
    ğ‘ğ‘ğ‘ (Î› (ğ´ğ‘ğ‘ t)) s
      â‰¡âŸ¨ ğ‘ğ‘ğ‘Î² (ğ´ğ‘ğ‘ t) s âŸ©
    ğ´ğ‘ğ‘ t âŸ¦ ğ’¾ğ’¹ Î“ âŠ• s âŸ§
      âˆ

  -- We finally get to the substitution law for applications;
  -- this follows from the axioms, with great difficulty.
  
  ğ‘ğ‘ğ‘âŸ¦âŸ§ : {Î“ Î” : ctx} {A B : ty} (t : tm Î” (A â‡› B)) (s : tm Î” A) (Ïƒ : tms Î“ Î”) â†’
    ğ‘ğ‘ğ‘ t s âŸ¦ Ïƒ âŸ§ â‰¡ ğ‘ğ‘ğ‘ (t âŸ¦ Ïƒ âŸ§) (s âŸ¦ Ïƒ âŸ§)
  ğ‘ğ‘ğ‘âŸ¦âŸ§ {Î“} {Î”} t s Ïƒ =
    ğ‘ğ‘ğ‘ t s âŸ¦ Ïƒ âŸ§
      â‰¡âŸ¨ ap (_âŸ¦ Ïƒ âŸ§) (ğ‘ğ‘ğ‘ğ´ğ‘ğ‘ t s) âŸ©
    ğ´ğ‘ğ‘ t âŸ¦ ğ’¾ğ’¹ Î” âŠ• s âŸ§ âŸ¦ Ïƒ âŸ§
      â‰¡âŸ¨ âŸ¦âŸ§âŸ¦âŸ§ (ğ´ğ‘ğ‘ t) (ğ’¾ğ’¹ Î”  âŠ• s) Ïƒ âŸ©
    ğ´ğ‘ğ‘ t âŸ¦ ğ’¾ğ’¹ Î” âŠ• s âŠš Ïƒ âŸ§
      â‰¡âŸ¨ ap (ğ´ğ‘ğ‘ t âŸ¦_âŸ§) (âŠ•âŠš (ğ’¾ğ’¹ Î”) s Ïƒ) âŸ©
    ğ´ğ‘ğ‘ t âŸ¦ (ğ’¾ğ’¹ Î”) âŠš Ïƒ âŠ• s âŸ¦ Ïƒ âŸ§ âŸ§
      â‰¡âŸ¨ (Î» i â†’ ğ´ğ‘ğ‘ t âŸ¦ ğ’¾ğ’¹L Ïƒ i âŠ• s âŸ¦ Ïƒ âŸ§ âŸ§) âŸ©
    ğ´ğ‘ğ‘ t âŸ¦ Ïƒ âŠ• s âŸ¦ Ïƒ âŸ§ âŸ§
      â‰¡âŸ¨ ap (ğ´ğ‘ğ‘ t âŸ¦_âŸ§) (lem Ïƒ (s âŸ¦ Ïƒ âŸ§) â»Â¹) âŸ©
    ğ´ğ‘ğ‘ t âŸ¦ (Ïƒ âŠš Ï€ âŠ• ğ‘§) âŠš (ğ’¾ğ’¹ Î“ âŠ• s âŸ¦ Ïƒ âŸ§) âŸ§
      â‰¡âŸ¨ âŸ¦âŸ§âŸ¦âŸ§ (ğ´ğ‘ğ‘ t) (Ïƒ âŠš Ï€ âŠ• ğ‘§) (ğ’¾ğ’¹ Î“ âŠ• s âŸ¦ Ïƒ âŸ§) â»Â¹ âŸ©
    ğ´ğ‘ğ‘ t âŸ¦ Ïƒ âŠš Ï€ âŠ• ğ‘§ âŸ§ âŸ¦ ğ’¾ğ’¹ Î“ âŠ• s âŸ¦ Ïƒ âŸ§ âŸ§
      â‰¡âŸ¨ ap _âŸ¦ ğ’¾ğ’¹ Î“ âŠ• s âŸ¦ Ïƒ âŸ§ âŸ§ (ğ´ğ‘ğ‘âŸ¦âŸ§ t Ïƒ â»Â¹) âŸ©
    ğ´ğ‘ğ‘ (t âŸ¦ Ïƒ âŸ§) âŸ¦ ğ’¾ğ’¹ Î“ âŠ• s âŸ¦ Ïƒ âŸ§ âŸ§
      â‰¡âŸ¨ ğ‘ğ‘ğ‘ğ´ğ‘ğ‘ (t âŸ¦ Ïƒ âŸ§) (s âŸ¦ Ïƒ âŸ§) â»Â¹ âŸ©
    ğ‘ğ‘ğ‘ (t âŸ¦ Ïƒ âŸ§) (s âŸ¦ Ïƒ âŸ§)
      âˆ
